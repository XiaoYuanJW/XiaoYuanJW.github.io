<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2022-06-04T07:07:59.338Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>YuanJW</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Spring Cloud（四） 负载均衡</title>
    <link href="http://example.com/2022/05/31/04.Spring%20Cloud%EF%BC%88%E5%9B%9B%EF%BC%89%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"/>
    <id>http://example.com/2022/05/31/04.Spring%20Cloud%EF%BC%88%E5%9B%9B%EF%BC%89%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/</id>
    <published>2022-05-31T00:31:22.000Z</published>
    <updated>2022-06-04T07:07:59.338Z</updated>
    
    <content type="html"><![CDATA[<h1 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h1><p>微服务架构在生成环境中，各个微服务会部署多个实例，负载均衡就是将服务消费者的请求分摊到多个服务提供者实例的过程，它可以增加系统的可用性和扩展性。</p><p>当我们使用RestTemplate来调用其他服务时，Ribbon可以方便的是实现负载均衡，版本迭代之后由LoadBalancer替代。</p><p>LoadBalancer的优势主要在于支持响应式编程方式异步访问客户端，依赖Spring Web Flux实现客户端负载均衡调用。</p><h2 id="RestTemplate-HTTP客户端"><a href="#RestTemplate-HTTP客户端" class="headerlink" title="RestTemplate-HTTP客户端"></a>RestTemplate-HTTP客户端</h2><blockquote><p>RestTemplate是一个HTTP客户端，使用它我们可以方便的调用HTTP接口，支持GET、POST、PUT、DELETE等方法。</p></blockquote><p>这里以Get方法为例，说明RestTemplate远程调用，具体可查看RestOperations接口的方法声明。</p><h3 id="GET请求方法"><a href="#GET请求方法" class="headerlink" title="GET请求方法"></a>GET请求方法</h3><p><img src="https://s2.loli.net/2022/05/31/cAka7wFVt3dmnv1.png" alt="image-20220531145524762"></p><h4 id="getForObject方法"><a href="#getForObject方法" class="headerlink" title="getForObject方法"></a>getForObject方法</h4><p>返回对象为响应体中数据转化成对象</p><p><img src="https://s2.loli.net/2022/05/31/n9RcYBbxta1huEm.png" alt="image-20220531145953530"></p><h4 id="getForEntity方法"><a href="#getForEntity方法" class="headerlink" title="getForEntity方法"></a>getForEntity方法</h4><p>返回对象为ResponseEntity对象，包含了响应中的一些重要信息，比如响应头、响应状态码、响应体等。</p><p><img src="https://s2.loli.net/2022/05/31/6hyec7OT2JoNPzb.png" alt="image-20220531155322989"></p><p>调试运行可以看到ResponseEntity对象里的具体信息</p><p><img src="https://s2.loli.net/2022/05/31/HqZF7riKdmLEg4l.png" alt="image-20220531160107761"></p><h3 id="POST请求方法"><a href="#POST请求方法" class="headerlink" title="POST请求方法"></a>POST请求方法</h3><p><img src="https://s2.loli.net/2022/05/31/KBhko1qaprPNC53.png" alt="image-20220531161914683"></p><h3 id="PUT请求方法"><a href="#PUT请求方法" class="headerlink" title="PUT请求方法"></a>PUT请求方法</h3><p><img src="https://s2.loli.net/2022/05/31/Xqf3cVzpdlSxIgW.png" alt="image-20220531161923943"></p><h3 id="DELETE请求方法"><a href="#DELETE请求方法" class="headerlink" title="DELETE请求方法"></a>DELETE请求方法</h3><p><img src="https://s2.loli.net/2022/05/31/mR9GJfv8kMUpzuD.png" alt="image-20220531161936372"></p><h2 id="使用Ribbon实现客户端侧负载均衡"><a href="#使用Ribbon实现客户端侧负载均衡" class="headerlink" title="使用Ribbon实现客户端侧负载均衡"></a>使用Ribbon实现客户端侧负载均衡</h2><h3 id="Ribbon简介"><a href="#Ribbon简介" class="headerlink" title="Ribbon简介"></a>Ribbon简介</h3><p>Spring Cloud Ribbon 是Spring Cloud Netflix 子项目的核心组件之一，主要给服务间调用及API网关转发提供负载均衡的功能，有助于控制HTTP和TCP客户端的行为。在服务消费者拉取服务提供者地址列表后，Ribbon基于某种负载均衡算法，自动帮助服务消费者发起请求。</p><p>Ribbon提供了很多负载均衡算法，例如轮询、随机等，还支持自定义的负载均衡算法。</p><p>在Spring Cloud中，当Ribbon与Eureka配合使用时，Ribbon自动从Eureka Server获取服务提供者地址列表，并基于负载均衡算法，请求其中一个服务提供者实例。</p><p><img src="https://s2.loli.net/2022/05/31/3kn5YHRgswdcfUD.png" alt="image-20220531144624058"></p><h3 id="服务消费者整合Ribbon"><a href="#服务消费者整合Ribbon" class="headerlink" title="服务消费者整合Ribbon"></a>服务消费者整合Ribbon</h3><p>由于之前的项目使用的Spring Cloud Netflix版本已经弃用Ribbon，所有我们需要修改响应的版本信息，这里就不做过多的赘述。</p><h4 id="项目引入依赖"><a href="#项目引入依赖" class="headerlink" title="项目引入依赖"></a>项目引入依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-ribbon<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="文件配置"><a href="#文件配置" class="headerlink" title="文件配置"></a>文件配置</h4><p>主要配置端口、注册中心地址以及服务调用路径</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8301</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/cloudstudy_borrow</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">13851176590</span><span class="string">++</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">borrow-service</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://root:123456@replica1:8005/eureka,</span></span><br><span class="line">                   <span class="string">http://root:123456@replica2:8006/eureka</span></span><br><span class="line"><span class="attr">service-url:</span></span><br><span class="line">  <span class="attr">user-service:</span> <span class="string">http://user-service</span></span><br><span class="line">  <span class="attr">book-service:</span> <span class="string">http://book-service</span></span><br></pre></td></tr></table></figure><h4 id="在RestTemplate注入方法上添加-LoadBalanced注解"><a href="#在RestTemplate注入方法上添加-LoadBalanced注解" class="headerlink" title="在RestTemplate注入方法上添加@LoadBalanced注解"></a>在RestTemplate注入方法上添加@LoadBalanced注解</h4><p>添加@LoadBalanced注解，就可为RestTemplate整合Ribbom，使其具备负载均衡的能力。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*注册RestTemplate对象*/</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="接口实现负载均衡的远程调用"><a href="#接口实现负载均衡的远程调用" class="headerlink" title="接口实现负载均衡的远程调用"></a>接口实现负载均衡的远程调用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BorrowService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BorrowMapper borrowMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RestTemplate restTemplate;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;service-url.user-service&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String userServiceUrl;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;service-url.book-service&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String bookServiceUrl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserBorrowDetail <span class="title function_">getBorrowByUser</span><span class="params">(Long uid)</span> &#123;</span><br><span class="line">        List&lt;Borrow&gt; borrows = borrowMapper.getBorrow(uid,<span class="literal">null</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> restTemplate.getForObject(userServiceUrl + <span class="string">&quot;/user/&quot;</span> + uid, User.class);</span><br><span class="line">        List&lt;Book&gt; books = borrows.stream().map(borrow -&gt; restTemplate.getForObject(bookServiceUrl + <span class="string">&quot;/book/&quot;</span> + borrow.getBid(), Book.class)).collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserBorrowDetail</span>(user, books);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> BookBorrowDetail <span class="title function_">getBorrowByBook</span><span class="params">(Long bid)</span> &#123;</span><br><span class="line">        List&lt;Borrow&gt; borrows = borrowMapper.getBorrow(<span class="literal">null</span>,bid);</span><br><span class="line">        List&lt;User&gt; users = borrows.stream().map(borrow -&gt; restTemplate.getForObject(userServiceUrl + <span class="string">&quot;/user/&quot;</span> + borrow.getUid(), User.class)).collect(Collectors.toList());</span><br><span class="line">        ResponseEntity&lt;Book&gt; entity = restTemplate.getForEntity(bookServiceUrl + <span class="string">&quot;/book/&quot;</span>+bid, Book.class);</span><br><span class="line">        <span class="keyword">if</span> (entity.getStatusCode().is2xxSuccessful()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BookBorrowDetail</span>(users, entity.getBody());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BookBorrowDetail</span>(users, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> BorrowDetail <span class="title function_">getBorrow</span><span class="params">(Long uid, Long bid)</span> &#123;</span><br><span class="line">        List&lt;Borrow&gt; borrows = borrowMapper.getBorrow(uid, bid);</span><br><span class="line">        List&lt;User&gt; users = borrows.stream().map(borrow -&gt; restTemplate.getForObject(userServiceUrl + <span class="string">&quot;/user/&quot;</span> + borrow.getUid(), User.class)).collect(Collectors.toList());</span><br><span class="line">        List&lt;Book&gt; books = borrows.stream().map(borrow -&gt; restTemplate.getForObject(bookServiceUrl + <span class="string">&quot;/book/&quot;</span> + borrow.getBid(), Book.class)).collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BorrowDetail</span>(users, books);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>控制层</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BorrowService borrowService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoadBalancerClient loadBalancerClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(BorrowController.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/borrow/user/&#123;uid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> UserBorrowDetail <span class="title function_">getBorrowByUser</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> Long uid)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> borrowService.getBorrowByUser(uid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/borrow/book/&#123;bid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> BookBorrowDetail <span class="title function_">getBorrowByBook</span><span class="params">(<span class="meta">@PathVariable(&quot;bid&quot;)</span> Long bid)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> borrowService.getBorrowByBook(bid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/borrow&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> BorrowDetail <span class="title function_">getBorrow</span><span class="params">(<span class="meta">@RequestParam(value = &quot;uid&quot;, required = true)</span> Long uid,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@RequestParam(value = &quot;bid&quot;, required = true)</span> Long bid)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> borrowService.getBorrow(uid, bid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/log-instance&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logUserInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ServiceInstance</span> <span class="variable">serviceInstance</span> <span class="operator">=</span> <span class="built_in">this</span>.loadBalancerClient.choose(<span class="string">&quot;user-service&quot;</span>);</span><br><span class="line">        BorrowController.logger.info(<span class="string">&quot;&#123;&#125;:&#123;&#125;:&#123;&#125;&quot;</span>, serviceInstance.getServiceId(), serviceInstance.getHost(), serviceInstance.getPort());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Ribbon原理"><a href="#Ribbon原理" class="headerlink" title="Ribbon原理"></a>Ribbon原理</h3><p>负载均衡拦截器在获取用户的请求地址后，会获取微服务的虚拟主机名，再从注册中心拉取微服务的网络地址列表，在服务列表进行负载均衡。</p><h3 id="LoadBalancerInterceptor方法"><a href="#LoadBalancerInterceptor方法" class="headerlink" title="LoadBalancerInterceptor方法"></a>LoadBalancerInterceptor方法</h3><p><img src="https://s2.loli.net/2022/06/04/5u8lHbiq2IwLsZK.png" alt="image-20220604011042764"></p><h4 id="ClientHttpRequestInterceptor接口"><a href="#ClientHttpRequestInterceptor接口" class="headerlink" title="ClientHttpRequestInterceptor接口"></a>ClientHttpRequestInterceptor接口</h4><p><img src="https://s2.loli.net/2022/06/04/hNT4dRpDCPGmKxo.png" alt="image-20220604011204139"></p><h4 id="接口方法具体实现"><a href="#接口方法具体实现" class="headerlink" title="接口方法具体实现"></a>接口方法具体实现</h4><p><img src="https://s2.loli.net/2022/06/04/N1i2zUhcSsEMZTG.png" alt="image-20220604011815218"></p><h4 id="负载均衡接口"><a href="#负载均衡接口" class="headerlink" title="负载均衡接口"></a>负载均衡接口</h4><p><img src="https://s2.loli.net/2022/06/04/IEDUkSawVr6Bo38.png" alt="image-20220604011927175"></p><h4 id="RibbonLoadBalancerClient"><a href="#RibbonLoadBalancerClient" class="headerlink" title="RibbonLoadBalancerClient"></a>RibbonLoadBalancerClient</h4><p><img src="https://s2.loli.net/2022/06/04/hS5IYyFbMdzEP93.png" alt="image-20220604012252580"></p><p><img src="https://s2.loli.net/2022/06/04/jxzdhaRfpMbri8g.png" alt="image-20220604013037564"></p><p><img src="https://s2.loli.net/2022/06/04/tNSx4zEI1PjUOHe.png" alt="image-20220604020317394"></p><h3 id="Ribbon负载均衡策略"><a href="#Ribbon负载均衡策略" class="headerlink" title="Ribbon负载均衡策略"></a>Ribbon负载均衡策略</h3><p>Ribbon的负载均衡规则是由IRule的接口定义，每一个子接口对应一种规则。</p><p><img src="https://s2.loli.net/2022/06/04/hnHiXkwaAFRm264.png" alt="image-20220604021231385"></p><blockquote><ul><li>com.netflix.loadbalancer.RandomRule：从提供服务的实例中以随机的方式；</li><li>com.netflix.loadbalancer.RoundRobinRule：以线性轮询的方式，就是维护一个计数器，从提供服务的实例中按顺序选取，第一次选第一个，第二次选第二个，以此类推，到最后一个以后再从头来过；</li><li>com.netflix.loadbalancer.RetryRule：在RoundRobinRule的基础上添加重试机制，即在指定的重试时间内，反复使用线性轮询策略来选择可用实例；</li><li>com.netflix.loadbalancer.WeightedResponseTimeRule：对RoundRobinRule的扩展，响应速度越快的实例选择权重越大，越容易被选择；</li><li>com.netflix.loadbalancer.BestAvailableRule：选择并发较小的实例；</li><li>com.netflix.loadbalancer.AvailabilityFilteringRule：先过滤掉故障实例，再选择并发较小的实例；</li><li>com.netflix.loadbalancer.ZoneAwareLoadBalancer：采用双重过滤，同时过滤不是同一区域的实例和故障实例，选择并发较小的实例。</li></ul></blockquote><p>通过自定义定义IRule实现可以修改负载均衡规则，由以下两种方式实现：</p><ul><li><h5 id="配置类IRule注入-全局配置"><a href="#配置类IRule注入-全局配置" class="headerlink" title="配置类IRule注入(全局配置)"></a>配置类IRule注入(全局配置)</h5></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> IRule <span class="title function_">randomRule</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomRule</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><h5 id="配置文件方式-服务绑定"><a href="#配置文件方式-服务绑定" class="headerlink" title="配置文件方式(服务绑定)"></a>配置文件方式(服务绑定)</h5></li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">user-service:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">NFLoadBalanverRuleClassName:</span> <span class="string">com.netflix.loadbalancer.RandomRule</span></span><br></pre></td></tr></table></figure><h3 id="Ribbon饥饿加载"><a href="#Ribbon饥饿加载" class="headerlink" title="Ribbon饥饿加载"></a>Ribbon饥饿加载</h3><p>Ribbon默认是采用懒加载，即第一次访问时会去创建LoadBalanceClient，请求时间很长</p><p>使用Ribbon的饥饿加载会在项目开启时创建，降低第一次访问的耗时</p><p>开启饥饿加载的方式，配置文件：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">eager-load:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">clients:</span></span><br><span class="line">      <span class="string">-user-service</span></span><br><span class="line">      <span class="string">-book-service</span></span><br></pre></td></tr></table></figure><h2 id="使用LoadBalancer实现客户端侧负载均衡"><a href="#使用LoadBalancer实现客户端侧负载均衡" class="headerlink" title="使用LoadBalancer实现客户端侧负载均衡"></a>使用LoadBalancer实现客户端侧负载均衡</h2><h3 id="服务消费者整合LoadBalancer"><a href="#服务消费者整合LoadBalancer" class="headerlink" title="服务消费者整合LoadBalancer"></a>服务消费者整合LoadBalancer</h3><p>整合步骤和Ribbon的整合步骤基本一致，只是依赖版本不同且无需引入Ribbon</p><p><img src="https://s2.loli.net/2022/06/04/FjU71SVsuKqReNJ.png" alt="image-20220604031524461"></p><h3 id="LoadBalancer原理"><a href="#LoadBalancer原理" class="headerlink" title="LoadBalancer原理"></a>LoadBalancer原理</h3><p><img src="https://s2.loli.net/2022/06/04/HntcLGT71OI8ezf.png" alt="img"></p><h4 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h4><p><img src="https://s2.loli.net/2022/06/04/souvc8PDjrLiEa9.jpg" alt="img"></p><h4 id="LoadBalanced注解开启负载均衡"><a href="#LoadBalanced注解开启负载均衡" class="headerlink" title="@LoadBalanced注解开启负载均衡"></a>@LoadBalanced注解开启负载均衡</h4><p><img src="https://s2.loli.net/2022/05/31/FVTlEocZC7dAgX4.png" alt="image-20220531102500703"></p><h4 id="客户端HTTP请求拦截器接口"><a href="#客户端HTTP请求拦截器接口" class="headerlink" title="客户端HTTP请求拦截器接口"></a>客户端HTTP请求拦截器接口</h4><p><img src="https://s2.loli.net/2022/05/31/NXIVysgG1m3f8Zn.png" alt="image-20220531102426240"></p><h4 id="负载均衡拦截器实现接口"><a href="#负载均衡拦截器实现接口" class="headerlink" title="负载均衡拦截器实现接口"></a>负载均衡拦截器实现接口</h4><p><img src="https://s2.loli.net/2022/05/31/EZq7PAYWDn6Nbmx.png" alt="image-20220531102336211"></p><h4 id="负载均衡客户端中execute接口方法"><a href="#负载均衡客户端中execute接口方法" class="headerlink" title="负载均衡客户端中execute接口方法"></a>负载均衡客户端中execute接口方法</h4><p><img src="https://s2.loli.net/2022/06/04/JwUVaTtpf26NiZK.png" alt="image-20220604031737840"></p><h4 id="BlockingLoadBalancerClient实现execute方法"><a href="#BlockingLoadBalancerClient实现execute方法" class="headerlink" title="BlockingLoadBalancerClient实现execute方法"></a>BlockingLoadBalancerClient实现execute方法</h4><p><img src="https://s2.loli.net/2022/06/04/JyHrIVhnLdkEN21.png" alt="image-20220604033125528"></p><h4 id="choose具体实现"><a href="#choose具体实现" class="headerlink" title="choose具体实现"></a>choose具体实现</h4><p><img src="https://s2.loli.net/2022/06/04/zrxKo9I2AJhQYEb.png" alt="image-20220604034427604"></p><h4 id="ReactiveLoadBalancer被不同规则的负载均衡器实现"><a href="#ReactiveLoadBalancer被不同规则的负载均衡器实现" class="headerlink" title="ReactiveLoadBalancer被不同规则的负载均衡器实现"></a>ReactiveLoadBalancer被不同规则的负载均衡器实现</h4><p><img src="https://s2.loli.net/2022/06/04/CifzRdGSx9UeF7v.png" alt="image-20220604034601307"></p><h4 id="默认由RoundRobinLoadBalancer即轮询负载均衡实现"><a href="#默认由RoundRobinLoadBalancer即轮询负载均衡实现" class="headerlink" title="默认由RoundRobinLoadBalancer即轮询负载均衡实现"></a>默认由RoundRobinLoadBalancer即轮询负载均衡实现</h4><p><img src="https://s2.loli.net/2022/06/04/P9qwhCGmdnS2oKJ.png" alt="image-20220604035134969"></p><h3 id="自定义负载均衡策略"><a href="#自定义负载均衡策略" class="headerlink" title="自定义负载均衡策略"></a>自定义负载均衡策略</h3><h4 id="创建负载均衡配置类"><a href="#创建负载均衡配置类" class="headerlink" title="创建负载均衡配置类"></a>创建负载均衡配置类</h4><p><img src="https://s2.loli.net/2022/06/04/lHi542fqrPbzvwZ.png" alt="image-20220604041507416"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoadBalancerConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ReactorLoadBalancer&lt;ServiceInstance&gt; <span class="title function_">randomLoadBalancer</span> <span class="params">(Environment environment, LoadBalancerClientFactory loadBalancerClientFactory)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomLoadBalancer</span>(loadBalancerClientFactory.getLazyProvider(name, ServiceInstanceListSupplier.class), name)<span class="comment">/*随机负载均衡策略*/</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="为指定服务指定负载均衡策略"><a href="#为指定服务指定负载均衡策略" class="headerlink" title="为指定服务指定负载均衡策略"></a>为指定服务指定负载均衡策略</h4><p><img src="https://s2.loli.net/2022/06/04/RTznUVK461PiZCo.png" alt="image-20220604125902447"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@LoadBalancerClients(</span></span><br><span class="line"><span class="meta">        value = &#123;</span></span><br><span class="line"><span class="meta">                @LoadBalancerClient(value = &quot;user-service&quot;, configuration = LoadBalancerConfig.class),</span></span><br><span class="line"><span class="meta">                @LoadBalancerClient(value = &quot;book-service&quot;, configuration = LoadBalancerConfig.class)</span></span><br><span class="line"><span class="meta">        &#125;, defaultConfiguration = LoadBalancerClientConfiguration.class</span></span><br><span class="line"><span class="meta">)</span></span><br></pre></td></tr></table></figure><p>我们发现远程调用user-service服务不在是通过轮询的方式，而是通过随机的负载均衡策略实现</p><p><img src="https://s2.loli.net/2022/06/04/67SJVhtDiTkIqNF.png" alt="image-20220604130204288"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;负载均衡&quot;&gt;&lt;a href=&quot;#负载均衡&quot; class=&quot;headerlink&quot; title=&quot;负载均衡&quot;&gt;&lt;/a&gt;负载均衡&lt;/h1&gt;&lt;p&gt;微服务架构在生成环境中，各个微服务会部署多个实例，负载均衡就是将服务消费者的请求分摊到多个服务提供者实例的过程，它可以增加系</summary>
      
    
    
    
    
    <category term="Spring Cloud" scheme="http://example.com/tags/Spring-Cloud/"/>
    
  </entry>
  
  <entry>
    <title>Spring Cloud（三） Eureka</title>
    <link href="http://example.com/2022/05/30/03.Spring%20Cloud%EF%BC%88%E4%B8%89%EF%BC%89Eureka/"/>
    <id>http://example.com/2022/05/30/03.Spring%20Cloud%EF%BC%88%E4%B8%89%EF%BC%89Eureka/</id>
    <published>2022-05-30T00:31:22.000Z</published>
    <updated>2022-05-31T01:20:44.164Z</updated>
    
    <content type="html"><![CDATA[<h1 id="服务注册与发现-Spring-Cloud-Eureka"><a href="#服务注册与发现-Spring-Cloud-Eureka" class="headerlink" title="服务注册与发现-Spring Cloud Eureka"></a>服务注册与发现-Spring Cloud Eureka</h1><p>Spring Cloud Eureka是Spring Cloud Netflix子项目的核心组件之一。主要用于微服务架构中的<strong>服务治理</strong>。</p><p>本章主要介绍微服务远程调用的<strong>提供者</strong>和<strong>消费者</strong>、<strong>Eureka</strong>的简介、Eureka<strong>注册中心</strong>的搭建、Eureka<strong>客户端</strong>的搭建、Eureka<strong>集群</strong>的搭建以及Eureka注册中心<strong>添加登录认证</strong>的方法。</p><h2 id="微服务远程调用的提供者和消费者"><a href="#微服务远程调用的提供者和消费者" class="headerlink" title="微服务远程调用的提供者和消费者"></a>微服务远程调用的提供者和消费者</h2><p>服务提供者：暴露接口给其他微服务调用</p><p>服务消费者：调用其他微服务提供的接口</p><p>服务提供者和消费者角色是<strong>相对</strong>的，一个服务可以同时是服务提供者和服务消费者</p><h2 id="服务调用存在的问题"><a href="#服务调用存在的问题" class="headerlink" title="服务调用存在的问题"></a>服务调用存在的问题</h2><p>在上一个微服务项目中，借阅服务使用RestTemplate调用用户和书籍微服务中的RESTFUL API，但是我们是将服务提供者的请求网络地址（IP和端口等）硬编码在代码中，这样做存在一定的问题：</p><ul><li>使用场景局限性强。如果服务提供的网络地址发送改变，将影响整个服务消费者。</li><li>无法动态伸缩。在实际的生产环境中，每个微服务一般都会部署多个实例以实现容灾和负载均衡，此外系统还应具备自动伸缩的能力，例如动态增减节点等。显然硬编码的方式难以实现上述需求。</li></ul><p>需要解决的问题：</p><ul><li>服务消费者如何获取服务提供者的地址信息和健康状态</li><li>服务消费者如何在多个服务提供者中进行选择，从而实现负载均衡和容灾处理 </li></ul><h2 id="服务发现机制"><a href="#服务发现机制" class="headerlink" title="服务发现机制"></a>服务发现机制</h2><p>面对硬编码提供服务提供地址的方式所带来的诸多问题，服务消费者需要一个强大的服务发现机制，服务消费者基于这种机制获取服务提供者的网络信息。这种机制可以通过微服务架构中的服务发现组件实现。</p><p>微服务项目使用服务发现组件后，系统的架构图如下：</p><p><img src="https://s2.loli.net/2022/05/29/lV7JcfMqwuCXySo.png" alt="image-20220529162012664"></p><p>其中服务提供者、服务消费者、服务发现组件的关系如下：</p><ul><li>各个微服务将自己的网络地址等信息注册并存储到服务发现组件中，当微服务的网络地址发送变更时，会重新注册到服务发现组件。</li><li>服务消费者从服务发现组件查询服务提供者的网络地址并使用地址调用服务提供者的接口</li><li>各个微服务与服务发现组件使用一定机制通信（例如心跳），服务发现组件如长时间无法与某微服务实例通信即发现某微服务实例无法访问，该实例则会被注销。</li></ul><p>服务发现组件具备功能如下：</p><ul><li>服务注册表：作为服务发现组件的核心，用于记录各个微服务的信息（包括名称、IP、端口等）。服务注册表提供查询API和管理API，查询API用于查询可用的微服务实例，管理API用于服务的注册和注销。</li><li>服务注册：当微服务启动时，将自己的信息注册到服务发现组件的过程。</li><li>服务发现：查询可用微服务列表及其网络地址的机制。</li><li>服务检查：服务发现组件使用一定的机制定时检测已注册的服务。</li></ul><h2 id="Eureka简介"><a href="#Eureka简介" class="headerlink" title="Eureka简介"></a>Eureka简介</h2><p>Spring Cloud Eureka是Netflix开源的服务发现组件，是基于REST的服务。它包含Server和Client两部分来实现服务的注册与发现。</p><p>每个微服务启动时向注册中心注册组件自己的地址及端口信息，注册中心维护着服务名称与服务实例的对应关系。每个微服务会定时从注册中心拉去服务信息列表，同时通过发送心跳等方式定时汇报自己的运行状态。当服务调用其他服务时。可以从自己获取到的服务列表中获取实例地址来进行远程调用 。</p><p>在基于Eureka的架构中，微服务角色可以被分成两类：</p><ul><li>Eureka Server：Eureka服务端即注册中心<ul><li>记录服务信息</li><li>心跳状态监控</li></ul></li><li>Eureka Client：Eureka客户端<ul><li>Provide：服务提供者<ul><li>注册服务信息到Eureka Server即注册中心</li><li>定时发送心跳汇报自己的运行状态</li></ul></li><li>Comsumer：服务消费者<ul><li>根据服务名称从Eureka Server即注册中心拉取服务列表</li><li>基于服务列表，使用负载均衡选中一个微服务的网络地址发起远程调用</li></ul></li></ul></li></ul><p><img src="https://s2.loli.net/2022/05/29/Z54x8MlcA3JFjna.png" alt="image-20220529162224930"></p><h2 id="Eureka原理"><a href="#Eureka原理" class="headerlink" title="Eureka原理"></a>Eureka原理</h2><p>Eureka架构图如下：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/7a7a226a66be550b3408854d90f1ef2e.png" alt="img"></p><ul><li>Application Service：服务提供者</li><li>Application Client：服务消费者</li><li>Make Remote Call：调用RESTful API的行为即远程调用</li></ul><p>Eureka包含两个组件：Eureka Server和Eureka Client</p><ul><li><p>Eureka Server：提供服务发现能力，各个微服务启动时，会向Eureka Server注册自己的信息（例如IP、端口、微服务名名名称等），Eureka Server会存储这些信息。</p></li><li><p>Eureka Client：是一个Java客户端，用于简化与Eureka Server的交互</p></li><li><p>心跳状态监控：当微服务启动后，微服务会周期性（默认30秒）地向Eureka Server发送心跳以及续约自己的”短租”，如果Eureka Server在一定时间内（默认90秒）没有接收到某个微服务实例的心跳，Eureka Server会注销该实例。</p></li><li><p>Eureka集群：在集群中，Eureka Server同样也是Eureka Client。多个Eureka Server实例，互相之间通过复制的方式来实现服务注册表中数据的同步。</p></li><li><p>Eureka Client缓存机制：Eureka Client会缓存服务注册表中的信息，微服务无须每次请求都查询Eureka Server，在降低Eureka Server压力的同时，即使Eureka Server所有节点宕掉，服务消费者依然可以使用缓存中的信息找到服务提供者网络地址并完成远程调用。</p><p>综上，Eureka通过心跳检查、客户端缓存等机制，提高了系统的灵活性和可用性。</p></li></ul><h2 id="搭建Eureka-Server即注册中心"><a href="#搭建Eureka-Server即注册中心" class="headerlink" title="搭建Eureka Server即注册中心"></a>搭建Eureka Server即注册中心</h2><h3 id="新建模块"><a href="#新建模块" class="headerlink" title="新建模块"></a>新建模块</h3><p><img src="https://s2.loli.net/2022/05/29/VlEBvsemphJWNAy.png" alt="image-20220529230825482"></p><p><img src="https://s2.loli.net/2022/05/29/y7BtOR1CTZJwbSv.png" alt="image-20220529230839199"></p><p><img src="https://s2.loli.net/2022/05/29/pyPvc6bijFMU7rD.png" alt="image-20220529230945601"></p><h3 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h3><h4 id="父项目中引入SpringCloud的依赖"><a href="#父项目中引入SpringCloud的依赖" class="headerlink" title="父项目中引入SpringCloud的依赖"></a>父项目中引入SpringCloud的依赖</h4><p><img src="https://s2.loli.net/2022/05/29/eiv41sVUwBCXjPg.png" alt="image-20220529233013558"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2021.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Eureka-Server项目添加依赖"><a href="#Eureka-Server项目添加依赖" class="headerlink" title="Eureka Server项目添加依赖"></a>Eureka Server项目添加依赖</h4><p><img src="https://s2.loli.net/2022/05/29/1b9porZfUy8Y4qJ.png" alt="image-20220529233048159"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="编写启动类并添加-EnableEurekaServer注解"><a href="#编写启动类并添加-EnableEurekaServer注解" class="headerlink" title="编写启动类并添加@EnableEurekaServer注解"></a>编写启动类并添加@EnableEurekaServer注解</h3><p><img src="https://s2.loli.net/2022/05/30/rLFcptg8yWd7qjG.png" alt="image-20220530090833112"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span><span class="comment">/*启用Euerka注册中心功能*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EurekaServerApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(EurekaServerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="添加配置文件"><a href="#添加配置文件" class="headerlink" title="添加配置文件"></a>添加配置文件</h3><p><img src="https://s2.loli.net/2022/05/29/ui9QmqMoplUAg5J.png" alt="image-20220529234631910"></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span> <span class="comment">#指定运行端口</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eureka-server</span> <span class="comment">#指定服务名称</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span> <span class="comment">#指定主机地址</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span> <span class="comment">#指定是否要从注册中心获取服务</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span> <span class="comment">#指定是否要注册到注册中心</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8001/eureka</span> <span class="comment">#Eureka Server交互地址,Eureka服务地址指向自己</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">enable-self-preservation:</span> <span class="literal">false</span> <span class="comment">#关闭保护模式</span></span><br></pre></td></tr></table></figure><h3 id="运行Eureka-Server应用"><a href="#运行Eureka-Server应用" class="headerlink" title="运行Eureka Server应用"></a>运行Eureka Server应用</h3><p><img src="https://s2.loli.net/2022/05/30/mupVIvriWRH2yAe.png" alt="image-20220530091057577"></p><h3 id="Eureka注册中心界面"><a href="#Eureka注册中心界面" class="headerlink" title="Eureka注册中心界面"></a>Eureka注册中心界面</h3><p>访问地址<a href="http://localhost:8001/">http://localhost:8001</a></p><p><img src="https://s2.loli.net/2022/05/30/CN8VoKwLfgvylqd.png" alt="image-20220530091231252"></p><h2 id="搭建Eureka-Client"><a href="#搭建Eureka-Client" class="headerlink" title="搭建Eureka Client"></a>搭建Eureka Client</h2><h3 id="服务注册"><a href="#服务注册" class="headerlink" title="服务注册"></a>服务注册</h3><h4 id="在Eureka-Client模块添加依赖"><a href="#在Eureka-Client模块添加依赖" class="headerlink" title="在Eureka Client模块添加依赖"></a>在Eureka Client模块添加依赖</h4><p><img src="https://s2.loli.net/2022/05/30/KVRC3HctnaWQAGZ.png" alt="image-20220530092853838"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="添加Eureka客户端配置"><a href="#添加Eureka客户端配置" class="headerlink" title="添加Eureka客户端配置"></a>添加Eureka客户端配置</h4><p><img src="https://s2.loli.net/2022/05/30/uSjH3VkJynCpXdt.png" alt="image-20220530094314995"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8101</span><br><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">    url: jdbc:mysql://localhost:3306/cloudstudy_user</span><br><span class="line">    username: root</span><br><span class="line">    password: 13851176590++</span><br><span class="line">  application:</span><br><span class="line">    name: user-service</span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    register-with-eureka: true</span><br><span class="line">    fetch-registry: true</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http://localhost:8001/eureka #配置注册中心地址</span><br></pre></td></tr></table></figure><h4 id="启动类添加-EnableDiscoveryClient注解"><a href="#启动类添加-EnableDiscoveryClient注解" class="headerlink" title="启动类添加@EnableDiscoveryClient注解"></a>启动类添加@EnableDiscoveryClient注解</h4><p><img src="https://s2.loli.net/2022/05/30/4179hFemiDjsCNU.png" alt="image-20220530094043696"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(UserApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="启动Eureka-client"><a href="#启动Eureka-client" class="headerlink" title="启动Eureka-client"></a>启动Eureka-client</h4><p><img src="https://s2.loli.net/2022/05/30/AhjuavyoBYZpzxt.png" alt="image-20220530094828200"></p><h4 id="多实例注册"><a href="#多实例注册" class="headerlink" title="多实例注册"></a>多实例注册</h4><p><img src="https://s2.loli.net/2022/05/30/v6e9Dg3zK124CFZ.png" alt="image-20220530103422230"></p><p><img src="https://s2.loli.net/2022/05/30/wIiRWnvJZUKoBSP.png" alt="image-20220530103502163"></p><p><img src="https://s2.loli.net/2022/05/30/eKNQI9Oz6Mj57wF.png" alt="image-20220530103756735"></p><p><img src="https://s2.loli.net/2022/05/30/pbPG2DtsRF6ulZe.png" alt="image-20220530103833705"></p><p>多实例注册提高了微服务的可用性，保证系统的安全性</p><h3 id="服务发现"><a href="#服务发现" class="headerlink" title="服务发现"></a>服务发现</h3><p>服务拉取是基于名称获取服务列表，再对服务列表做负载均衡</p><h4 id="服务名代替网络地址"><a href="#服务名代替网络地址" class="headerlink" title="服务名代替网络地址"></a>服务名代替网络地址</h4><p><img src="https://s2.loli.net/2022/05/30/JoEukZp3wLnlcKv.png" alt="image-20220530102056442"></p><h4 id="添加负载均衡注解"><a href="#添加负载均衡注解" class="headerlink" title="添加负载均衡注解"></a>添加负载均衡注解</h4><p><img src="https://s2.loli.net/2022/05/30/PItDYak79eC1ldz.png" alt="image-20220530102208990"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*注册RestTemplate对象*/</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/30/A2TDOLv9s3Rh8Bt.png" alt="image-20220530103935690"></p><h2 id="搭建Eureka注册中心集群"><a href="#搭建Eureka注册中心集群" class="headerlink" title="搭建Eureka注册中心集群"></a>搭建Eureka注册中心集群</h2><p>搭建Eureka注册中心集群，实现注册中心的高可用</p><p>Eureka Client会定时连接Eureka Server获取服务注册表中的信息并缓存在本地，由于Eureka Client的缓存机制，微服务在远程调用时总是使用本地缓存中的数据，即使在Eureka Server发生宕机的情况，也不会影响服务之间的调用，但如果某些服务出现了不可用的情况，Eureka Client的缓存信息没有被更新，就会影响微服务的调用，甚至影响系统的可用性。因此，在现实的生产环境中我们需要部署一个多节点、高可用的Eureka Server集群。</p><p>Eureka Server可以通过运行多个实例以及相互注册的方式实现高可用的部署，Eureka Server实例会彼此增量地同步信息，从而确保所有节点数据的一致性。</p><p><img src="https://img-blog.csdnimg.cn/img_convert/888d4743950f5566e914d44d5c12d435.png" alt="image-20220323205531185"></p><h3 id="搭建两个注册中心"><a href="#搭建两个注册中心" class="headerlink" title="搭建两个注册中心"></a>搭建两个注册中心</h3><h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><p>在eureka-server添加配置文件application-replica1.yml配置第二个注册中心</p><p><img src="https://s2.loli.net/2022/05/30/lIAzOuCenGBqL1J.png" alt="image-20220530152133297"></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8002</span> <span class="comment">#指定运行端口</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eureka-server</span> <span class="comment">#指定服务名称</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">replica1</span> <span class="comment">#指定主机地址</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span> <span class="comment">#指定是否要从注册中心获取服务</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment">#指定是否要注册到注册中心</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://replica2:8003/eureka</span> <span class="comment">#服务地址</span></span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/30/VkUzIL3oQSuCcAN.png" alt="image-20220530152146152"></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8003</span> <span class="comment">#指定运行端口</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eureka-server</span> <span class="comment">#指定服务名称</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">replica2</span> <span class="comment">#指定主机地址</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span> <span class="comment">#指定是否要从注册中心获取服务</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment">#指定是否要注册到注册中心</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://replica1:8002/eureka</span> <span class="comment">#服务地址</span></span><br></pre></td></tr></table></figure><p>通过两个个注册中心的相互注册，搭建了注册中心的双节点集群</p><h4 id="修改hosts文件"><a href="#修改hosts文件" class="headerlink" title="修改hosts文件"></a>修改hosts文件</h4><p>由于defaultZone使用了自定义地址，需要配置系统的hosts文件</p><p>Mac下文件路径为<code>/etc/hosts</code>，Windows下为<code>C:\Windows\system32\drivers\etc\hosts</code>:</p><p><img src="https://s2.loli.net/2022/05/30/aROKhgqMjJYDBiN.png" alt="image-20220530135729704"></p><h3 id="运行Eureka注册中心集群"><a href="#运行Eureka注册中心集群" class="headerlink" title="运行Eureka注册中心集群"></a>运行Eureka注册中心集群</h3><p>通过不同的配置文件启动同一个Spring Boot应用</p><h4 id="添加启动配置"><a href="#添加启动配置" class="headerlink" title="添加启动配置"></a>添加启动配置</h4><p>分别以application-replica1.yml和application-replica2.yml为活动配置文件来启动eureka-server</p><p><img src="https://s2.loli.net/2022/05/30/nqYW8zxE5itGyml.png" alt="image-20220530153529543"></p><p><img src="https://s2.loli.net/2022/05/30/TkxSCoaQ9ndVFjg.png" alt="image-20220530153736918"></p><p><img src="https://s2.loli.net/2022/05/30/MVf6XPrvLiN3Jkn.png" alt="image-20220530153815504"></p><h4 id="启用两个eurake-server节点"><a href="#启用两个eurake-server节点" class="headerlink" title="启用两个eurake server节点"></a>启用两个eurake server节点</h4><p><img src="https://s2.loli.net/2022/05/30/E9UJgYLDir5Ipk6.png" alt="image-20220530154937885"></p><p>访问其中一个注册中心<a href="http://replica1:8002/">http://replica1:8002</a>发现另一个已经成为其备份</p><p><img src="https://s2.loli.net/2022/05/30/PGNCmWqEow7RJvp.png" alt="image-20220530155052338"></p><h3 id="应用注册到Eureka-Server集群"><a href="#应用注册到Eureka-Server集群" class="headerlink" title="应用注册到Eureka Server集群"></a>应用注册到Eureka Server集群</h3><p>配置多个Eureka Server地址，将其注册到多个Eureka Server集群中</p><p><img src="https://s2.loli.net/2022/05/30/A2pcj36ZWqMVQkC.png" alt="image-20220530155802325"></p><p>启动微服务</p><p><img src="https://s2.loli.net/2022/05/30/xN8cFTbfzDQJ3gK.png" alt="image-20220530163228042"></p><h2 id="Eureka-Server注册中心添加认证"><a href="#Eureka-Server注册中心添加认证" class="headerlink" title="Eureka Server注册中心添加认证"></a>Eureka Server注册中心添加认证</h2><p>Eureka Server是默认允许匿名访问，我们考研构建一个需要登录才可以访问的Eureka Server</p><h3 id="创建eureka-security-server模块"><a href="#创建eureka-security-server模块" class="headerlink" title="创建eureka-security-server模块"></a>创建eureka-security-server模块</h3><p><img src="https://s2.loli.net/2022/05/30/F4ObCNjRmPVAyrU.png" alt="image-20220530164447800"></p><h4 id="添加依赖-1"><a href="#添加依赖-1" class="headerlink" title="添加依赖"></a>添加依赖</h4><p><img src="https://s2.loli.net/2022/05/30/RQF5eyD82L7izux.png" alt="image-20220530170636183"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="添加配置文件-1"><a href="#添加配置文件-1" class="headerlink" title="添加配置文件"></a>添加配置文件</h4><p>主要配置登录注册中心的用户名和密码</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8004</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eureka-security-server</span></span><br><span class="line">  <span class="attr">security:</span></span><br><span class="line">    <span class="attr">user:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8004/eureka</span></span><br></pre></td></tr></table></figure><h4 id="添加启动类"><a href="#添加启动类" class="headerlink" title="添加启动类"></a>添加启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EurekaSecurityServerApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(EnableEurekaServer.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="添加Java配置WebSecurityConfig"><a href="#添加Java配置WebSecurityConfig" class="headerlink" title="添加Java配置WebSecurityConfig"></a>添加Java配置WebSecurityConfig</h4><p>默认情况下，添加Spring  Security依赖的应用，每个请求需要添加CSRF token才可以访问。配置Eureka客户端注册时不用添加即配置/eureka/**路径不需要CSRF token</p><p><img src="https://s2.loli.net/2022/05/30/ehyfAtsCYO3UkTo.png" alt="image-20220530171701890"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http.csrf().ignoringAntMatchers(<span class="string">&quot;/eureka/**&quot;</span>);</span><br><span class="line">        <span class="built_in">super</span>.configure(http);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="运行eureka-security-server"><a href="#运行eureka-security-server" class="headerlink" title="运行eureka-security-server"></a>运行eureka-security-server</h4><p>访问<a href="http://localhost:8004/%E9%9C%80%E8%A6%81%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81">http://localhost:8004/需要登录认证</a></p><p><img src="https://s2.loli.net/2022/05/30/TSlE5UI7ORMkdif.png" alt="image-20220530171039729"></p><p><img src="https://s2.loli.net/2022/05/30/daWvRHf7knqMP8L.png" alt="image-20220530171105097"></p><h3 id="注册服务到登录认证的注册中心"><a href="#注册服务到登录认证的注册中心" class="headerlink" title="注册服务到登录认证的注册中心"></a>注册服务到登录认证的注册中心</h3><h4 id="修改配置文件中注册中心地址格式"><a href="#修改配置文件中注册中心地址格式" class="headerlink" title="修改配置文件中注册中心地址格式"></a>修改配置文件中注册中心地址格式</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://$&#123;username&#125;:$&#123;password&#125;@$&#123;hostname&#125;:$&#123;port&#125;/eureka</span></span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/30/gQmkXL1C9YshdlH.png" alt="image-20220530171734918"></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://root:123456@localhost:8004/eureka</span> <span class="comment">#配置注册中心地址</span></span><br></pre></td></tr></table></figure><h4 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h4><p><img src="https://s2.loli.net/2022/05/30/wyqGXxbNBTVrj1A.png" alt="image-20220530171929036"></p><h3 id="集群搭建"><a href="#集群搭建" class="headerlink" title="集群搭建"></a>集群搭建</h3><h4 id="创建两个配置文件"><a href="#创建两个配置文件" class="headerlink" title="创建两个配置文件"></a>创建两个配置文件</h4><p><img src="https://s2.loli.net/2022/05/31/RGXeISWEBv63hDQ.png" alt="image-20220531002656132"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8005</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: eureka-security-server</span><br><span class="line">  security:</span><br><span class="line">    user:</span><br><span class="line">      name: root</span><br><span class="line">      password: 123456</span><br><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    hostname: replica1</span><br><span class="line">  client:</span><br><span class="line">    fetch-registry: true</span><br><span class="line">    register-with-eureka: true</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http://root:123456@replica2:8006/eureka</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/31/HbkdMBzK6juVtQv.png" alt="image-20220531002750066"></p><h4 id="添加启动配置-1"><a href="#添加启动配置-1" class="headerlink" title="添加启动配置"></a>添加启动配置</h4><p><img src="https://s2.loli.net/2022/05/31/ZSb7uDLYAE319I6.png" alt="image-20220531002857225"></p><h4 id="服务实例注册集群"><a href="#服务实例注册集群" class="headerlink" title="服务实例注册集群"></a>服务实例注册集群</h4><p><img src="https://s2.loli.net/2022/05/31/YjLv6xli2ZysBOf.png" alt="image-20220531003217666"></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://root:123456@replica1:8005/eureka,</span></span><br><span class="line">                   <span class="string">http://root:123456@replica2:8006/eureka</span></span><br></pre></td></tr></table></figure><h4 id="启动服务-1"><a href="#启动服务-1" class="headerlink" title="启动服务"></a>启动服务</h4><p><img src="https://s2.loli.net/2022/05/31/PtduxykDXIG2bi1.png" alt="image-20220531003451642"></p><p><img src="https://s2.loli.net/2022/05/31/2oHqwz1DRAyKCEh.png" alt="image-20220531003504170"></p><p><img src="https://s2.loli.net/2022/05/31/PjOv7SgFnuY826I.png" alt="image-20220531003553520"></p><h2 id="Eureka常用配置"><a href="#Eureka常用配置" class="headerlink" title="Eureka常用配置"></a>Eureka常用配置</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span> <span class="comment">#eureka客户端配置</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment">#是否将自己注册到eureka服务器</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span> <span class="comment">#是否获取eureka服务端上注册的服务列表</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8001/eureka</span> <span class="comment">#指定注册中心地址</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment">#启用eureka客户端</span></span><br><span class="line">    <span class="attr">registry-fetch-interval-seconds:</span> <span class="number">30</span> <span class="comment">#定义从eureka服务端获取服务列表的时间间隔</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">30</span> <span class="comment">#定义服务注册中心续约的时间间隔</span></span><br><span class="line">    <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">90</span> <span class="comment">#定义服务多久不去续约认为服务失效</span></span><br><span class="line">    <span class="attr">metadata-map:</span></span><br><span class="line">      <span class="attr">zone:</span> <span class="string">jiangsu</span> <span class="comment">#所在区域</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span> <span class="comment">#服务主机名称</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">false</span> <span class="comment">#是否优先使用ip来作为主机名</span></span><br><span class="line">  <span class="attr">server:</span> <span class="comment">#eureka服务端配置</span></span><br><span class="line">    <span class="attr">enable-self-preservation:</span> <span class="literal">false</span> <span class="comment">#关闭eureka服务端的保护机制</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;服务注册与发现-Spring-Cloud-Eureka&quot;&gt;&lt;a href=&quot;#服务注册与发现-Spring-Cloud-Eureka&quot; class=&quot;headerlink&quot; title=&quot;服务注册与发现-Spring Cloud Eureka&quot;&gt;&lt;/a&gt;服务注册与</summary>
      
    
    
    
    
    <category term="Spring Cloud" scheme="http://example.com/tags/Spring-Cloud/"/>
    
  </entry>
  
  <entry>
    <title>Spring Cloud（二）微服务实战</title>
    <link href="http://example.com/2022/05/28/02.Spring%20Cloud%EF%BC%88%E4%BA%8C%EF%BC%89%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/"/>
    <id>http://example.com/2022/05/28/02.Spring%20Cloud%EF%BC%88%E4%BA%8C%EF%BC%89%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/</id>
    <published>2022-05-28T12:10:10.000Z</published>
    <updated>2022-05-29T07:15:11.913Z</updated>
    
    <content type="html"><![CDATA[<h1 id="微服务实战"><a href="#微服务实战" class="headerlink" title="微服务实战"></a>微服务实战</h1><p>本项目示例是一个图书借阅系统，本教程会更加注重于架构设计上的讲解，弱化业务功能和实现原理方面的研究。</p><h2 id="服务的拆分"><a href="#服务的拆分" class="headerlink" title="服务的拆分"></a>服务的拆分</h2><ul><li>单一职责：不同微服务开发不同的业务</li><li>数据独立：每个微服务拥有自己的数据库</li><li>面向服务：将业务暴露为接口，供其他微服务使用</li></ul><h2 id="微服务项目搭建"><a href="#微服务项目搭建" class="headerlink" title="微服务项目搭建"></a>微服务项目搭建</h2><h3 id="构建父项目"><a href="#构建父项目" class="headerlink" title="构建父项目"></a>构建父项目</h3><p><img src="https://s2.loli.net/2022/05/28/a72gwLiNPjVFeRH.png" alt="image-20220528192605703"></p><p><img src="https://s2.loli.net/2022/05/28/eCGT67JqZaKtNlU.png" alt="image-20220528192547239"></p><p><img src="https://s2.loli.net/2022/05/28/RNz2cU6XVTPt9fK.png" alt="image-20220528193009882"></p><p><img src="https://s2.loli.net/2022/05/28/USyIcn1vuzAXB9V.png" alt="image-20220528193030549"></p><p><img src="https://s2.loli.net/2022/05/28/zXlJeVg1QLt87B4.png" alt="image-20220528193137238"></p><p>父项目只负责依赖管理，删除无用文件</p><p><img src="https://s2.loli.net/2022/05/28/J7xueRdADkHwt5z.png" alt="image-20220528193644465"></p><p>导入通用依赖</p><p><img src="https://s2.loli.net/2022/05/28/ZzNhY5FTbKqHwtB.png" alt="image-20220528204437918"></p><h3 id="新建子模块"><a href="#新建子模块" class="headerlink" title="新建子模块"></a>新建子模块</h3><p><img src="https://s2.loli.net/2022/05/28/NXE49tnoBUPc3eq.png" alt="image-20220528201545755"></p><p><img src="https://s2.loli.net/2022/05/28/T5ZBHuAUWO9SGoQ.png" alt="image-20220528202339977"></p><p><img src="https://s2.loli.net/2022/05/28/8rnsHlRKtIfeEQ7.png" alt="image-20220528201719876"></p><p><img src="https://s2.loli.net/2022/05/28/YI56QSyDsnabFhO.png" alt="image-20220528202407207"></p><h4 id="创建启动类"><a href="#创建启动类" class="headerlink" title="创建启动类"></a>创建启动类</h4><p><img src="https://s2.loli.net/2022/05/28/N4ql57AQSXri1km.png" alt="image-20220528202711560"></p><p><img src="https://s2.loli.net/2022/05/28/QCdOZNnXKEcj6qT.png" alt="image-20220528202911977"></p><h4 id="创建配置文件-application-yml"><a href="#创建配置文件-application-yml" class="headerlink" title="创建配置文件-application.yml"></a>创建配置文件-application.yml</h4><p><img src="https://s2.loli.net/2022/05/28/gI9Uy7xrqkOhsVM.png" alt="image-20220528203410113"></p><h4 id="添加服务端口号"><a href="#添加服务端口号" class="headerlink" title="添加服务端口号"></a>添加服务端口号</h4><p><img src="https://s2.loli.net/2022/05/28/abqlzVI8JG2Otgm.png" alt="image-20220528203852132"></p><h4 id="导入spring-boot-starter-web依赖"><a href="#导入spring-boot-starter-web依赖" class="headerlink" title="导入spring-boot-starter-web依赖"></a>导入spring-boot-starter-web依赖</h4><p><img src="https://s2.loli.net/2022/05/28/KH85dGoLpMCzbDm.png" alt="image-20220528204039657"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="数据库设计"><a href="#数据库设计" class="headerlink" title="数据库设计"></a>数据库设计</h3><p>在实际的应用场景中，每个微服务都有自己的数据库服务器，按照单一职责的原则，每个微服务只会操作自己的数据库。</p><p><img src="https://s2.loli.net/2022/05/28/DYycWiIN8qjb4R6.png" alt="image-20220528234437570"></p><p><img src="https://s2.loli.net/2022/05/28/u3pVNGjP2XUcLns.png" alt="image-20220528235133900"></p><p><img src="https://s2.loli.net/2022/05/28/c78gVLrtkxBKeYT.png" alt="image-20220528235150408"></p><p><img src="https://s2.loli.net/2022/05/28/AE4pBzKDtfMalGU.png" alt="image-20220528235202429"></p><p><img src="https://s2.loli.net/2022/05/28/RBTK51ZW8McUnVS.png" alt="image-20220528235214185"></p><h4 id="添加索引"><a href="#添加索引" class="headerlink" title="添加索引"></a>添加索引</h4><p><img src="https://s2.loli.net/2022/05/29/horHEXnksBOu9vY.png" alt="image-20220529000109085"></p><p>在父项目引入MyBatis依赖进行版本管理</p><p><img src="https://s2.loli.net/2022/05/29/sjFcVO2AorpKDxf.png" alt="image-20220529001036883"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--依赖版本号管理--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在子项目中引入Mybatis依赖</p><p><img src="https://s2.loli.net/2022/05/29/ndfhVgvwGiZR41b.png" alt="image-20220529001154257"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>数据源信息配置</p><p><img src="https://s2.loli.net/2022/05/29/ge3VYPZcUAHqXrz.png" alt="image-20220529001617549"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">    url: jdbc:mysql://localhost:3306/cloudstudy_user</span><br><span class="line">    username: root</span><br><span class="line">    password: 13851176590++</span><br></pre></td></tr></table></figure><h3 id="公共项目创建和引入"><a href="#公共项目创建和引入" class="headerlink" title="公共项目创建和引入"></a>公共项目创建和引入</h3><p>将服务需要用到的实体类单独放入一个项目模块中，将需要实体类的项目模块引用存放共用实体的项目，以保证每个微服务的实体类信息共用。</p><p><img src="https://s2.loli.net/2022/05/29/wpRF6obg1ZkrhM2.png" alt="image-20220529003014986"></p><p>在需要共用实体类的项目模块中引入</p><p><img src="https://s2.loli.net/2022/05/29/phz256BWgL8uCGy.png" alt="image-20220529003513439"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="书籍信息查询业务"><a href="#书籍信息查询业务" class="headerlink" title="书籍信息查询业务"></a>书籍信息查询业务</h3><p><img src="https://s2.loli.net/2022/05/29/AvF5qp8Oh1LPNyQ.png" alt="image-20220529005821372"></p><h4 id="创建Dao"><a href="#创建Dao" class="headerlink" title="创建Dao:"></a>创建Dao:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from book_info where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    Book <span class="title function_">getBookById</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="创建Service"><a href="#创建Service" class="headerlink" title="创建Service:"></a>创建Service:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    Book <span class="title function_">getBookById</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BookMapper bookMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">getBookById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookMapper.getBookById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="创建Controller"><a href="#创建Controller" class="headerlink" title="创建Controller:"></a>创建Controller:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/book/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">getBookById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookService.getBookById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/29/Bk2RXv7gut6r4Ld.png" alt="image-20220529011059566"></p><p>用户信息查询业务同理</p><h2 id="服务提供和消费"><a href="#服务提供和消费" class="headerlink" title="服务提供和消费"></a>服务提供和消费</h2><h3 id="借阅业务查询业务"><a href="#借阅业务查询业务" class="headerlink" title="借阅业务查询业务"></a>借阅业务查询业务</h3><p>微服务构建的是一个分布式系统，微服务之间通过网络进行通信，可以使用服务提供者与服务消费者来描述微服务之间的调用关系。</p><p><img src="https://s2.loli.net/2022/05/29/Dr5c9uHVUOaIQv7.png" alt="image-20220529150533296"></p><p>借阅服务是一个关联性比较强的服务，需要在查询出借阅信息的基础上，获取借阅用户和借阅书籍的详细信息。根据单一职责和数据独立的原则，我们可以让一个服务作为消费者调用另一个服务即提供者来获取信息。</p><p><img src="https://s2.loli.net/2022/05/29/UOwuHFY9t8M4g5J.jpg" alt="image-20220323140322502"></p><h3 id="RestTemplate-HTTP请求工具实现远程调用"><a href="#RestTemplate-HTTP请求工具实现远程调用" class="headerlink" title="RestTemplate-HTTP请求工具实现远程调用"></a>RestTemplate-HTTP请求工具实现远程调用</h3><p>这里先使用RestTemplate作为HTTP请求工具，它提供了常见的REST请求方案的模版，例如 GET 请求、POST 请求、PUT 请求、DELETE 请求以及一些通用的请求执行方法 exchange 以及 execute。</p><h4 id="注册RestTemplate"><a href="#注册RestTemplate" class="headerlink" title="注册RestTemplate"></a>注册RestTemplate</h4><p>由于启动类也是配置类，我们可以直接在启动类实现RestTemplate对象的创建和注册。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.test.dao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(BorrowApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*注册RestTemplate对象*/</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里以查询用户借阅信息为例</p><p><img src="https://s2.loli.net/2022/05/29/s7FTxkGOK3jZVor.png" alt="image-20220529142333093"></p><h4 id="配置文件配置mybatis"><a href="#配置文件配置mybatis" class="headerlink" title="配置文件配置mybatis"></a>配置文件配置mybatis</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">classpath:mapper/*.xml</span></span><br></pre></td></tr></table></figure><p>在启动类添加@MapperScan</p><p><img src="https://s2.loli.net/2022/05/29/Zb5J6cEQU3xwjiV.png" alt="image-20220529142636511"></p><h4 id="业务处理"><a href="#业务处理" class="headerlink" title="业务处理"></a>业务处理</h4><h5 id="创建服务实体类"><a href="#创建服务实体类" class="headerlink" title="创建服务实体类:"></a>创建服务实体类:</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserBorrowDetail</span> &#123;</span><br><span class="line">    User user;</span><br><span class="line">    List&lt;Book&gt; books;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="创建Dao-1"><a href="#创建Dao-1" class="headerlink" title="创建Dao:"></a>创建Dao:</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BorrowMapper</span> &#123;</span><br><span class="line">    List&lt;Borrow&gt; <span class="title function_">getBorrow</span><span class="params">(Long uid, Long bid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="创建mapper-xml"><a href="#创建mapper-xml" class="headerlink" title="创建mapper.xml:"></a>创建mapper.xml:</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.test.dao.BorrowMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getBorrow&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.test.entity.Borrow&quot;</span>&gt;</span></span><br><span class="line">        SELECT * FROM borrow_info</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;uid != null&quot;</span>&gt;</span> uid = #&#123;uid&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bid != null&quot;</span>&gt;</span> and bid = #&#123;bid&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="创建Service-1"><a href="#创建Service-1" class="headerlink" title="创建Service:"></a>创建Service:</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BorrowService</span> &#123;</span><br><span class="line">    UserBorrowDetail <span class="title function_">getBorrowByUser</span><span class="params">(Long uid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="使用RestTemplate服务远程调用"><a href="#使用RestTemplate服务远程调用" class="headerlink" title="使用RestTemplate服务远程调用"></a>使用RestTemplate服务远程调用</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BorrowService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BorrowMapper borrowMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserBorrowDetail <span class="title function_">getBorrowByUser</span><span class="params">(Long uid)</span> &#123;</span><br><span class="line">        List&lt;Borrow&gt; borrows = borrowMapper.getBorrow(uid,<span class="literal">null</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> restTemplate.getForObject(<span class="string">&quot;http://localhost:8101/user/&quot;</span> + uid, User.class);</span><br><span class="line">        List&lt;Book&gt; books = borrows.stream().map(borrow -&gt; restTemplate.getForObject(<span class="string">&quot;http://localhost:8201/book/&quot;</span> + borrow.getBid(), Book.class)).collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserBorrowDetail</span>(user, books);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure><h5 id="创建Controller-1"><a href="#创建Controller-1" class="headerlink" title="创建Controller:"></a>创建Controller:</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BorrowService borrowService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/borrow/user/&#123;uid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> UserBorrowDetail <span class="title function_">getBorrowByUser</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> Long uid)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> borrowService.getBorrowByUser(uid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/29/CsgT2OHu9ZGbVcN.png" alt="image-20220529143045741"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;微服务实战&quot;&gt;&lt;a href=&quot;#微服务实战&quot; class=&quot;headerlink&quot; title=&quot;微服务实战&quot;&gt;&lt;/a&gt;微服务实战&lt;/h1&gt;&lt;p&gt;本项目示例是一个图书借阅系统，本教程会更加注重于架构设计上的讲解，弱化业务功能和实现原理方面的研究。&lt;/p&gt;
&lt;h2</summary>
      
    
    
    
    
    <category term="Spring Cloud" scheme="http://example.com/tags/Spring-Cloud/"/>
    
  </entry>
  
  <entry>
    <title>Spring Cloud（一）前言和简介</title>
    <link href="http://example.com/2022/05/26/01.Spring%20Cloud%EF%BC%88%E4%B8%80%EF%BC%89%E5%89%8D%E8%A8%80%E5%92%8C%E7%AE%80%E4%BB%8B/"/>
    <id>http://example.com/2022/05/26/01.Spring%20Cloud%EF%BC%88%E4%B8%80%EF%BC%89%E5%89%8D%E8%A8%80%E5%92%8C%E7%AE%80%E4%BB%8B/</id>
    <published>2022-05-26T14:30:55.000Z</published>
    <updated>2022-05-29T06:57:20.365Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spring-Cloud"><a href="#Spring-Cloud" class="headerlink" title="Spring Cloud"></a>Spring Cloud</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="单体应用架构"><a href="#单体应用架构" class="headerlink" title="单体应用架构"></a>单体应用架构</h3><p>基于SpringBoot框架，我们可以轻松的完成一个单体应用的搭建，单体应用是一个归档包包含整个系统所有功能的应用程序，它将系统的各项功能融于一体。</p><p><img src="https://s2.loli.net/2022/05/25/cCfj24EezbqaPQM.png" alt="image-20220525104057057"></p><p>单体应用容易搭建、部署和测试等，然而随着需求、功能和用户的不断增加，单体应用出现了复杂性高、技术债务、部署频率低、可靠性差、扩展能力受限、阻碍技术创新等问题，因此如今单体应用很难满足互联网时代业务快速变化的需要。</p><h3 id="微服务"><a href="#微服务" class="headerlink" title="微服务"></a>微服务</h3><p>如何解决单体应用架构存在的问题，<strong>微服务</strong>是一种全新架构模式，它有助于解决这些问题。Martin Fowler在2014年提出了“微服务”架构，他对于“微服务”的描述如下：</p><blockquote><p> In short, the microservice architectural style is an approach to developing a single application as a suite of small services, each running in its own process and communicating with lightweight mechanisms, often an HTTP resource API. These services are built around business capabilities and independently deployable by fully automated deployment machinery. There is a bare minimum of centralized management of these services, which may be written in different programming languages and use different data storage technologies.</p></blockquote><p>用中文表述就是,微服务架构风格是一种将一个单一应用程序开发为-一组小型服务的方法，每个服务运行在自己的进程中，服务间通信采用轻量级通信机制(通常用HTTP资源API)。这些服务围绕业务能力构建并且可通过全自动部署机制独立部署。这些服务共用一个最小型的集中式的管理，服务可用不同的语言开发,使用不同的数据存储技术。</p><p>因此微服务架构具备以下特点：</p><ul><li>微服务将单体应用拆分为一个个微服务,每个微服务为独立的业务开发,一个微服务只关注某个特定功能</li><li>每个微服务可以在自己的进程中独立运行,一系列独立运行的微服务共同构建整个系统</li><li>微服务之间通过一些轻量级的通信机制进行通信和数据交互,可以实现不同的微服务使用不同的语言和数据存储技术</li><li>支持全自动的部署机制，一个微服务可以部署在多个服务器，保证微服务的高可用。</li></ul><p><img src="https://s2.loli.net/2022/05/25/9KHi6WZlPpTgD4t.png" alt="image-20220525110414340"></p><p>整个应用被分解为多个微服务，各个微服务独立运行在自己的进程中，并分别有自己的数据库、微服务之间使用REST或者其他通信协议。</p><h3 id="微服务架构的优点"><a href="#微服务架构的优点" class="headerlink" title="微服务架构的优点"></a>微服务架构的优点</h3><p>相比于单体应用架构，微服务架构具有如下优点：</p><ul><li>业务模块划分清晰、易于开发和维护</li><li>局部修改，易于部署</li><li>技术栈不受限</li><li>伸缩性强，高可用</li></ul><h3 id="微服务架构面临的挑战"><a href="#微服务架构面临的挑战" class="headerlink" title="微服务架构面临的挑战"></a>微服务架构面临的挑战</h3><ul><li>通信接口调整和运维成本提高</li><li>系统复杂性提高，分布式系统需要考虑系统管理和监控、容错、网络延迟、分布式事务等问题</li></ul><h3 id="微服务设计原则"><a href="#微服务设计原则" class="headerlink" title="微服务设计原则"></a>微服务设计原则</h3><h4 id="单一职责原则"><a href="#单一职责原则" class="headerlink" title="单一职责原则"></a>单一职责原则</h4><p>单一职责原则是指一个单元（类、方法或服务等）只应关注整个系统功能中单独、有界限的一部分。这一原则可以帮助我们更加优雅地开发、更便捷地交付。</p><h4 id="服务自治原则"><a href="#服务自治原则" class="headerlink" title="服务自治原则"></a>服务自治原则</h4><p>服务自治是指每个微服务应具备独立的业务能力、依赖与运行环境。在微服务架构中，服务是独立的业务单元，与其他服务高度解耦。每个微服务从 构建、开发、测试、部署都可以独立运行，不依赖于其他服务。</p><h4 id="轻量级通信机制"><a href="#轻量级通信机制" class="headerlink" title="轻量级通信机制"></a>轻量级通信机制</h4><p>微服务之间应该通过轻量级的通信机制进行交互。轻量级的通信机制应具备体量小、跨语言跨平台的特点。常用的协议有REST、AMQP、STOMP、MQTT等。</p><h4 id="微服务粒度"><a href="#微服务粒度" class="headerlink" title="微服务粒度"></a>微服务粒度</h4><p>在微服务的设计阶段，使用合适的粒度划分微服务，确定其边界，保证微服务之间相对独立并保持松耦合。</p><p>领域驱动设计（Domain Driven Design）中的“界限上下文”可作为划分微服务边界、确定微服务粒度的重要依据。</p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>微服务架构的演进是一个循序渐进的过程，系统会根据需求业务的变化，对微服务进行重构，甚至重新划分，让架构更加合理，最终实现微服务的开发、部署、测试以及运维效率高的目的。</p><h3 id="微服务架构的实现"><a href="#微服务架构的实现" class="headerlink" title="微服务架构的实现"></a>微服务架构的实现</h3><p>微服务应用的实现相较于单体架构，需要开发框架的支持、一些自动化部署的工具、以及Iaas、PaaS或CaaS等的支持。</p><h4 id="开发框架选择：Spring-Cloud"><a href="#开发框架选择：Spring-Cloud" class="headerlink" title="开发框架选择：Spring Cloud"></a>开发框架选择：Spring Cloud</h4><p>Spring Cloud基于Spring框架一套分布式解决方案，具备开箱即用的生产特性，提升开发效率。</p><h4 id="运行平台"><a href="#运行平台" class="headerlink" title="运行平台"></a>运行平台</h4><p>微服务可以部署在PC Server、阿里云、AWS等云计算平台。处于轻量、灵活、应用支撑等方面考虑，本文将微服务署在Docker上。</p><h3 id="架构图及常用组件"><a href="#架构图及常用组件" class="headerlink" title="架构图及常用组件"></a>架构图及常用组件</h3><p><img src="https://s2.loli.net/2022/05/26/tnqRixhw4N26M8T.png" alt="image-20220526215843868"></p><p><img src="https://s2.loli.net/2022/05/27/k6LUTyzKMbm7fHS.png" alt="image-20220527234509921"></p><h3 id="微服务常用技术栈"><a href="#微服务常用技术栈" class="headerlink" title="微服务常用技术栈"></a>微服务常用技术栈</h3><p><img src="https://s2.loli.net/2022/05/28/ufzmh8rXIe2wdyN.png" alt="image-20220528041614896"></p><h2 id="SpringCloud简介"><a href="#SpringCloud简介" class="headerlink" title="SpringCloud简介"></a>SpringCloud简介</h2><h3 id="Spring-Cloud的介绍"><a href="#Spring-Cloud的介绍" class="headerlink" title="Spring Cloud的介绍"></a>Spring Cloud的介绍</h3><p>Spring Cloud是Spring提供的一套<strong>分布式解决方案</strong>，用于快速构建分布式系统的通用模式的工具集 。目的是<strong>协调任何服务</strong>，<strong>简化分布式系统开发</strong>。</p><p>Spring Cloud对常见的分布式系统模式提供了简单易用的<strong>编程模型</strong>，帮助开发者构建弹性、可靠、协调的应用程序。</p><p>Spring Cloud<strong>提供</strong>了<strong>快速构建分布式协调架构</strong>的<strong>组件</strong>，例如服务发现、配置管理、断路器、智能路由、微代理、控制总线、一次性令牌、全局锁定、领导选举、分布式会话、集群状态等。</p><p><img src="https://s2.loli.net/2022/05/25/ETdZKgP2Lzuxm5D.png" alt="来自Spring官网"></p><h3 id="Spring-Cloud的特点"><a href="#Spring-Cloud的特点" class="headerlink" title="Spring Cloud的特点"></a>Spring Cloud的特点</h3><ul><li>基于Spring框架，具备约定优于配置、开箱即用和快速启动等特性</li><li>适用于各种环境。开发和部署在PC Server或各种云环境等</li><li>隐藏组件的复杂性、提供声明式、无xml的配置方式</li><li>组件丰富、功能齐全且轻量级，选型中立，灵活，各个组件解耦。</li></ul><h3 id="Spring-Cloud组件概述"><a href="#Spring-Cloud组件概述" class="headerlink" title="Spring Cloud组件概述"></a>Spring Cloud组件概述</h3><h4 id="Spring-Cloud-Eureka"><a href="#Spring-Cloud-Eureka" class="headerlink" title="Spring Cloud Eureka"></a>Spring Cloud Eureka</h4><p><strong>服务治理</strong>组件，包括服务端的<strong>服务注册</strong>中心和客户端的<strong>服务发现</strong>机制。</p><h4 id="Spring-Cloud-Ribbon"><a href="#Spring-Cloud-Ribbon" class="headerlink" title="Spring Cloud Ribbon"></a>Spring Cloud Ribbon</h4><p><strong>负载均衡的服务调用</strong>组件，具有多种负载均衡调用策略。</p><h4 id="Spring-Cloud-Hystrix"><a href="#Spring-Cloud-Hystrix" class="headerlink" title="Spring Cloud Hystrix"></a>Spring Cloud Hystrix</h4><p><strong>服务容错</strong>组件，实现了<strong>断路器</strong>模式，为依赖服务的出错和延迟提供了容错能力。</p><h4 id="Spring-Cloud-Feign"><a href="#Spring-Cloud-Feign" class="headerlink" title="Spring Cloud Feign"></a>Spring Cloud Feign</h4><p>基于Ribbon和Hystrix的<strong>声明式服务调用</strong>组件。</p><h4 id="Spring-Cloud-Zuul"><a href="#Spring-Cloud-Zuul" class="headerlink" title="Spring Cloud Zuul"></a>Spring Cloud Zuul</h4><p><strong>API网关</strong>组件，对请求提供<strong>路由</strong>及<strong>过滤</strong>功能。</p><h4 id="Spring-Cloud-Bus"><a href="#Spring-Cloud-Bus" class="headerlink" title="Spring Cloud Bus"></a>Spring Cloud Bus</h4><p>用于<strong>传播集群状态变化</strong>的<strong>消息总线</strong>，使用轻量级<strong>消息代理链接分布式系统中的节点</strong>，可以用来<strong>动态刷新集群中的服务配置</strong>。</p><h4 id="Spring-Cloud-config"><a href="#Spring-Cloud-config" class="headerlink" title="Spring Cloud config"></a>Spring Cloud config</h4><p>集中<strong>配置管理</strong>工具，分布式系统中统一的<strong>外部配置管理</strong>，默认<strong>使用Git</strong>来<strong>存储配置</strong>，支持<strong>客户端配置的刷新</strong>及加密、<strong>解密</strong>操作。</p><h4 id="Spring-Cloud-Consul"><a href="#Spring-Cloud-Consul" class="headerlink" title="Spring Cloud Consul"></a>Spring Cloud Consul</h4><p>基于Hashicorp Consul的<strong>服务治理</strong>组件。</p><h4 id="Spring-Cloud-Security"><a href="#Spring-Cloud-Security" class="headerlink" title="Spring Cloud Security"></a>Spring Cloud Security</h4><p>安全工具包，对Zuul代理中的负载均衡<strong>OAuth2客户端</strong>及<strong>登录认证</strong>进行支持。</p><h4 id="Spring-Cloud-Bus-1"><a href="#Spring-Cloud-Bus-1" class="headerlink" title="Spring Cloud Bus"></a>Spring Cloud Bus</h4><p>使用轻量级的消息代理来连接微服务架构中的各个服务，主要用于广播状态更改或其他管理指令。</p><h4 id="Spring-Cloud-Sleuth"><a href="#Spring-Cloud-Sleuth" class="headerlink" title="Spring Cloud Sleuth"></a>Spring Cloud Sleuth</h4><p>Spring Cloud应用程序的<strong>分布式请求链路跟踪</strong>，支持使用Zipkin、HTrace和基于日志（例如ELK）的跟踪。</p><h4 id="Spring-Cloud-Stream"><a href="#Spring-Cloud-Stream" class="headerlink" title="Spring Cloud Stream"></a>Spring Cloud Stream</h4><p>轻量级<strong>事件驱动微服务</strong>框架，可以使用简单的<strong>声明式模型</strong>来<strong>发送及接收消息</strong>，主要实现为Apache Kafka及RabbitMQ。</p><h4 id="Spring-Cloud-Task"><a href="#Spring-Cloud-Task" class="headerlink" title="Spring Cloud Task"></a>Spring Cloud Task</h4><p>用于<strong>快速构建短暂</strong>、<strong>有限数据处理任务</strong>的微服务框架，用于向应用中添加功能性和非功能性的特征。</p><h4 id="Spring-Cloud-Zookeeper"><a href="#Spring-Cloud-Zookeeper" class="headerlink" title="Spring Cloud Zookeeper"></a>Spring Cloud Zookeeper</h4><p>基于Apache Zookeeper的服务治理组件。</p><h4 id="Spring-Cloud-Gateway"><a href="#Spring-Cloud-Gateway" class="headerlink" title="Spring Cloud Gateway"></a>Spring Cloud Gateway</h4><p><strong>API网关组件</strong>，<strong>对请求提供路由及过滤</strong>功能。</p><h4 id="Spring-Cloud-OpenFegin"><a href="#Spring-Cloud-OpenFegin" class="headerlink" title="Spring Cloud OpenFegin"></a>Spring Cloud OpenFegin</h4><p>基于Ribbon和Hystrix的<strong>声明式服务调用</strong>组件，可以<strong>动态创建基于Spring MVC注解的接口实现</strong>，用于<strong>服务调用</strong>，在Spring Cloud2.0中已经取代Feign。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Spring-Cloud&quot;&gt;&lt;a href=&quot;#Spring-Cloud&quot; class=&quot;headerlink&quot; title=&quot;Spring Cloud&quot;&gt;&lt;/a&gt;Spring Cloud&lt;/h1&gt;&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;</summary>
      
    
    
    
    
    <category term="Spring Cloud" scheme="http://example.com/tags/Spring-Cloud/"/>
    
  </entry>
  
  <entry>
    <title>Docsify</title>
    <link href="http://example.com/2022/05/22/Docsify/"/>
    <id>http://example.com/2022/05/22/Docsify/</id>
    <published>2022-05-22T09:18:55.000Z</published>
    <updated>2022-05-22T15:00:21.386Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Docsify"><a href="#Docsify" class="headerlink" title="Docsify"></a>Docsify</h1><h2 id="Docsify简介"><a href="#Docsify简介" class="headerlink" title="Docsify简介"></a>Docsify简介</h2><p>Docsify是一个动态生成的文档网站的工具，Docsify不会生成静态的HTML文件，它会在运行时完成对Markdown文件的加载和解析。</p><p>本文将主要介绍如何使用Docsify快速搭建一个快捷、轻量级的个人&amp;团队文档。</p><h2 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h2><h3 id="安装Node-js"><a href="#安装Node-js" class="headerlink" title="安装Node.js"></a>安装Node.js</h3><p>Node.js是JavaScript运行环境，支持JavaScript运行在服务端的开发平台</p><p>Node.js官网地址：<a href="https://nodejs.org/">https://nodejs.org/</a></p><p><img src="https://s2.loli.net/2022/05/21/TOC8w2ZSvfdFgJN.png" alt="202205201211462"></p><p><img src="https://s2.loli.net/2022/05/21/GIvEb4esqrDlFTy.png" alt="202205201226136"></p><h3 id="安装docsify-cli工具"><a href="#安装docsify-cli工具" class="headerlink" title="安装docsify-cli工具"></a>安装docsify-cli工具</h3><p>docsify-cli进行本地初始化和实时预览</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm i docsify-cli -g</span><br><span class="line">//推荐使用图内镜像</span><br><span class="line">cnpm i docsify-cli -g</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/22/3ty5M4Lz1g2VlKN.png" alt="image-20220522173914010"></p><h3 id="初始化项目结构"><a href="#初始化项目结构" class="headerlink" title="初始化项目结构"></a>初始化项目结构</h3><p>新建一个docs文件夹，通过init初始化项目</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docsify init ./docs</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/22/HBorcbEiqQXhdS8.png" alt="image-20220522174002177"></p><p><img src="https://s2.loli.net/2022/05/22/DPrEomUQW5nuMZt.png" alt="image-20220522174024315"></p><p><img src="https://s2.loli.net/2022/05/22/GbMueCUpT1ZSrDs.png" alt="image-20220522180143594"></p><h3 id="本地运行"><a href="#本地运行" class="headerlink" title="本地运行"></a>本地运行</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docsify serve docs</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/22/A24lQ35SWLxprsO.png" alt="image-20220522174218091"></p><p><img src="https://s2.loli.net/2022/05/22/zgjxPEOnU1WFCBR.png" alt="image-20220522174156828"></p><h3 id="基础配置文件"><a href="#基础配置文件" class="headerlink" title="基础配置文件"></a>基础配置文件</h3><h4 id="基础配置项-index-html"><a href="#基础配置项-index-html" class="headerlink" title="基础配置项-index.html"></a>基础配置项-index.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Docsify By XiaoYuanJW<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge,chrome=1&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span> <span class="attr">content</span>=<span class="string">&quot;Description&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, user-scalable = no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 设置图标 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/favicon.ico&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/x-icon&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;shortcut icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/favicon.ico&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/x-icon&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 默认主题 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;//cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 加载中 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">$docsify</span> = &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">name</span>: <span class="string">&#x27;Docsify By XiaoYuanJW&#x27;</span>,<span class="comment">//项目名称</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">repo</span>: <span class="string">&#x27;https://github.com/XiaoYuanJW&#x27;</span>,<span class="comment">//仓库地址</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">loadSidebar</span>: <span class="literal">true</span>,<span class="comment">//侧边框支持</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">loadNavbar</span>: <span class="literal">true</span>,<span class="comment">//导航栏支持</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">coverpage</span>: <span class="literal">true</span>,<span class="comment">//封面支持</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">maxLevel</span>: <span class="number">5</span>,<span class="comment">//设置最大支持渲染的标题层级</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">subMaxLevel</span>: <span class="number">4</span>,<span class="comment">//设置生成目录的最大层级</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">mergeNavbar</span>: <span class="literal">true</span>,<span class="comment">//小屏设备合并导航栏到侧边栏</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">alias</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&#x27;/.*/_sidebar.md&#x27;</span>: <span class="string">&#x27;/_sidebar.md&#x27;</span><span class="comment">//防止意外回退</span></span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">alias</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&#x27;/.*/_navbar.md&#x27;</span>: <span class="string">&#x27;/_navbar.md&#x27;</span><span class="comment">//防止意外回退</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;  </span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 搜索配置 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">$docsify</span> = &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">search</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">maxAge</span>: <span class="number">86400000</span>,<span class="comment">//过期时间，单位毫秒，默认一天</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">paths</span>: auto,<span class="comment">//注意：仅适用于paths: &#x27;auto&#x27;模式</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 支持本地化</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">placeholder</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;/zh-cn/&#x27;</span>: <span class="string">&#x27;搜索&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;/&#x27;</span>: <span class="string">&#x27;Type to search&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">noData</span>: <span class="string">&#x27;can not find results&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">depth</span>: <span class="number">4</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">hideOtherSidebarContent</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">namespace</span>: <span class="string">&#x27;Docsify By XiaoYuanJW&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Docsify v4 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//cdn.jsdelivr.net/npm/docsify@4&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- docsify的js依赖 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//cdn.jsdelivr.net/npm/docsify/lib/docsify.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- emoji表情支持 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//cdn.jsdelivr.net/npm/docsify/lib/plugins/emoji.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 图片放大缩小支持 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//cdn.jsdelivr.net/npm/docsify/lib/plugins/zoom-image.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 搜索功能支持 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--Click to copy支持--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//cdn.jsdelivr.net/npm/docsify-copy-code/dist/docsify-copy-code.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 代码高亮 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//unpkg.com/prismjs/components/prism-bash.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//unpkg.com/prismjs/components/prism-java.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//unpkg.com/prismjs/components/prism-sql.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="封面配置文件-coverpage-md"><a href="#封面配置文件-coverpage-md" class="headerlink" title="封面配置文件-_coverpage.md"></a>封面配置文件-_coverpage.md</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># Java学习记录</span></span><br><span class="line"><span class="quote">&gt; Notes of Java Created by XiaoYuanJW</span></span><br><span class="line"></span><br><span class="line">Java学习过程和记录</span><br><span class="line"></span><br><span class="line">[<span class="string">GitHub</span>](<span class="link">https://github.com/XiaoYuanJW</span>)</span><br><span class="line">[<span class="string">Get Started</span>](<span class="link">README.md</span>)</span><br></pre></td></tr></table></figure><h4 id="侧边栏配置文件-sidebar-md"><a href="#侧边栏配置文件-sidebar-md" class="headerlink" title="侧边栏配置文件-_sidebar.md"></a>侧边栏配置文件-_sidebar.md</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">*</span> 基础篇</span><br><span class="line"><span class="bullet">  *</span> [<span class="string">MySQL</span>](<span class="link">basic/MySQL.md</span>)</span><br><span class="line"><span class="bullet">*</span> 架构篇</span><br><span class="line"><span class="bullet">  *</span> [<span class="string">SpringBoot</span>](<span class="link">architect/SpringBoot.md</span>)</span><br><span class="line"><span class="bullet">  *</span> [<span class="string">MyBatis</span>](<span class="link">architect/MyBatis.md</span>)</span><br><span class="line"><span class="bullet">  *</span> [<span class="string">SpringCloud</span>](<span class="link">architect/SpringCloud.md</span>)</span><br></pre></td></tr></table></figure><h4 id="导航栏配置文件-navbar-md"><a href="#导航栏配置文件-navbar-md" class="headerlink" title="导航栏配置文件-_navbar.md"></a>导航栏配置文件-_navbar.md</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">*</span> 网站</span><br><span class="line"><span class="bullet">  *</span> [<span class="string">myBlog</span>](<span class="link">https://xiaoyuanjw.github.io/</span>)</span><br><span class="line"><span class="bullet">  *</span> [<span class="string">Leetcode</span>](<span class="link">https://leetcode.cn/u/xiaoyuanjw/</span>)</span><br><span class="line"><span class="bullet">*</span> 项目地址</span><br><span class="line"><span class="bullet">  *</span> [<span class="string">myMall</span>](<span class="link">https://github.com/XiaoYuanJW/mymall_pro</span>)</span><br></pre></td></tr></table></figure><h3 id="部署远端-Github"><a href="#部署远端-Github" class="headerlink" title="部署远端-Github"></a>部署远端-Github</h3><h4 id="新建代码仓库"><a href="#新建代码仓库" class="headerlink" title="新建代码仓库"></a>新建代码仓库</h4><p><img src="https://pic3.zhimg.com/80/v2-aa77dbcb386e9a433d0a37aaba306876_720w.png" alt="img"></p><h4 id="提交仓库"><a href="#提交仓库" class="headerlink" title="提交仓库"></a>提交仓库</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git remote add origin https://github.com/XiaoYuanJW/Docsify.git</span><br><span class="line">git add *</span><br><span class="line">git commit -m &quot;first commit&quot;</span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/22/tk1vo6yR4FnIT9V.png" alt="image-20220522215447029"></p><h4 id="开启GitHub-Pages服务"><a href="#开启GitHub-Pages服务" class="headerlink" title="开启GitHub Pages服务"></a>开启GitHub Pages服务</h4><p><img src="https://s2.loli.net/2022/05/22/PGOi2RDIUQEo6A1.png" alt="image-20220522224557192"></p><p><img src="https://s2.loli.net/2022/05/22/HYZlx8MC7qWXfjS.png" alt="image-20220522224450431"></p><p><img src="https://s2.loli.net/2022/05/22/SyUNLaZ9TjEHWJV.png" alt="image-20220522225032813"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Docsify&quot;&gt;&lt;a href=&quot;#Docsify&quot; class=&quot;headerlink&quot; title=&quot;Docsify&quot;&gt;&lt;/a&gt;Docsify&lt;/h1&gt;&lt;h2 id=&quot;Docsify简介&quot;&gt;&lt;a href=&quot;#Docsify简介&quot; class=&quot;header</summary>
      
    
    
    
    
    <category term="Others" scheme="http://example.com/tags/Others/"/>
    
  </entry>
  
  <entry>
    <title>Hexo</title>
    <link href="http://example.com/2022/05/21/Hexo/"/>
    <id>http://example.com/2022/05/21/Hexo/</id>
    <published>2022-05-20T18:13:55.000Z</published>
    <updated>2022-05-20T18:55:11.962Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Hexo"><a href="#Hexo" class="headerlink" title="Hexo"></a>Hexo</h1><h2 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h2><h3 id="安装Hexo框架"><a href="#安装Hexo框架" class="headerlink" title="安装Hexo框架"></a>安装Hexo框架</h3><h4 id="安装Node-js"><a href="#安装Node-js" class="headerlink" title="安装Node.js"></a>安装Node.js</h4><p>Node.js是JavaScript运行环境，支持JavaScript运行在服务端的开发平台</p><p>Node.js官网地址：<a href="https://nodejs.org/">https://nodejs.org/</a></p><p><img src="https://s2.loli.net/2022/05/21/TOC8w2ZSvfdFgJN.png" alt="202205201211462"></p><p><img src="https://s2.loli.net/2022/05/21/GIvEb4esqrDlFTy.png" alt="202205201226136"></p><h4 id="查看node和npm版本"><a href="#查看node和npm版本" class="headerlink" title="查看node和npm版本"></a>查看node和npm版本</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/21/rgEyeiRcdTj7kFq.png" alt="202205201230549"></p><h4 id="安装淘宝镜像源的cnpm管理器"><a href="#安装淘宝镜像源的cnpm管理器" class="headerlink" title="安装淘宝镜像源的cnpm管理器"></a>安装淘宝镜像源的cnpm管理器</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry=http://registry.npm.taobao.org</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/21/NCnrHDb2Fw8qjIa.png" alt="202205201235464"></p><h4 id="使用cnpm安装hexo"><a href="#使用cnpm安装hexo" class="headerlink" title="使用cnpm安装hexo"></a>使用cnpm安装hexo</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install -g hexo-cli</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/21/NrPBRmnvYGF1i8J.png" alt="202205201237355"></p><p><img src="https://s2.loli.net/2022/05/21/5Vc2yJ4APoKEn9L.png" alt="202205202055699"></p><h3 id="新建本地博客服务"><a href="#新建本地博客服务" class="headerlink" title="新建本地博客服务"></a>新建本地博客服务</h3><h4 id="新建文件夹并进入该目录"><a href="#新建文件夹并进入该目录" class="headerlink" title="新建文件夹并进入该目录"></a>新建文件夹并进入该目录</h4><p><img src="https://s2.loli.net/2022/05/21/uOWaGfYP7FiMvJx.png" alt="202205202328578"></p><h4 id="初始化hexo"><a href="#初始化hexo" class="headerlink" title="初始化hexo"></a>初始化hexo</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/21/rIjyqmQtHoZ65XK.png" alt="202205202357848"></p><p><img src="https://s2.loli.net/2022/05/21/EYILBe5Gz1sKmpv.png" alt="202205202357655"></p><h4 id="启动本地服务"><a href="#启动本地服务" class="headerlink" title="启动本地服务"></a>启动本地服务</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/21/pB3Sgz4Rl1nAsrY.png" alt="202205202359271"></p><h4 id="本地访问地址"><a href="#本地访问地址" class="headerlink" title="本地访问地址"></a>本地访问地址</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:4000/</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/21/8MDVjfRg9UadxHo.png" alt="202205210000921"></p><h4 id="创建新的文章"><a href="#创建新的文章" class="headerlink" title="创建新的文章"></a>创建新的文章</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo n &quot;My New Post&quot;</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/21/HgeRZyahA3jP5fd.png" alt="202205210005873"></p><h4 id="清理并生成"><a href="#清理并生成" class="headerlink" title="清理并生成"></a>清理并生成</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/21/7t8aARp25ns4zYF.png" alt="202205210008839"></p><h3 id="远端部署Github"><a href="#远端部署Github" class="headerlink" title="远端部署Github"></a>远端部署Github</h3><h4 id="创建一个新的仓库"><a href="#创建一个新的仓库" class="headerlink" title="创建一个新的仓库"></a>创建一个新的仓库</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YourGithubName.github.io</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/21/lZNmv2BaRI3zOow.png" alt="image-20220521013933355"></p><h4 id="在Blog目录下安装git部署插件"><a href="#在Blog目录下安装git部署插件" class="headerlink" title="在Blog目录下安装git部署插件"></a>在Blog目录下安装git部署插件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install --save hexo-deployer-git</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/21/pX61UCDBTFakeKS.png" alt="image-20220521014255050"></p><h4 id="配置-config-yml"><a href="#配置-config-yml" class="headerlink" title="配置_config.yml"></a>配置_config.yml</h4><p><img src="https://s2.loli.net/2022/05/21/7xKjgYCRUXvMfOQ.png" alt="image-20220521014451812"></p><p><img src="https://s2.loli.net/2022/05/21/NcFBdCJlhGkyeVY.png" alt="image-20220521015324639"></p><h4 id="部署到Github远端"><a href="#部署到Github远端" class="headerlink" title="部署到Github远端"></a>部署到Github远端</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/21/TGDAKj5SauzUpOB.png" alt="image-20220521015431257"></p><h4 id="查看博客"><a href="#查看博客" class="headerlink" title="查看博客"></a>查看博客</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://YourGithubName.github.io/ </span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/21/UHpLAeJX9bYqNa1.png" alt="image-20220521015704706"></p><h3 id="修改主题"><a href="#修改主题" class="headerlink" title="修改主题"></a>修改主题</h3><h4 id="选择主题-Butterfly"><a href="#选择主题-Butterfly" class="headerlink" title="选择主题-Butterfly"></a>选择主题-Butterfly</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//官网</span><br><span class="line">https://butterfly.js.org/</span><br><span class="line">//Git仓库</span><br><span class="line">https://github.com/jerryc127/hexo-theme-butterfly</span><br></pre></td></tr></table></figure><h4 id="主题下载"><a href="#主题下载" class="headerlink" title="主题下载"></a>主题下载</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//克隆到themes目录下的butterfly文件夹</span><br><span class="line">git clone https://github.com/jerryc127/hexo-theme-butterfly themes/butterfly</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/21/CPYofTxe8DmQ5iU.png" alt="image-20220521023716102"></p><h4 id="修改配置-config-yml"><a href="#修改配置-config-yml" class="headerlink" title="修改配置_config.yml"></a>修改配置_config.yml</h4><p><img src="https://s2.loli.net/2022/05/21/zf4Wja2liQxqhZc.png" alt="image-20220521023849882"></p><h4 id="执行命令"><a href="#执行命令" class="headerlink" title="执行命令"></a>执行命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save hexo-renderer-jade hexo-generator-feed hexo-generator-sitemap hexo-browsersync hexo-generator-archive</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/21/XutWCqQwcRKzpJP.png" alt="image-20220521024656434"></p><h4 id="清理缓存"><a href="#清理缓存" class="headerlink" title="清理缓存"></a>清理缓存</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br></pre></td></tr></table></figure><h4 id="生成静态文件"><a href="#生成静态文件" class="headerlink" title="生成静态文件"></a>生成静态文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure><h4 id="运行本地服务"><a href="#运行本地服务" class="headerlink" title="运行本地服务"></a>运行本地服务</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure><h4 id="部署远端"><a href="#部署远端" class="headerlink" title="部署远端"></a>部署远端</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/05/21/wUDJId1PV7ZLHvh.png" alt="image-20220521025504184"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Hexo&quot;&gt;&lt;a href=&quot;#Hexo&quot; class=&quot;headerlink&quot; title=&quot;Hexo&quot;&gt;&lt;/a&gt;Hexo&lt;/h1&gt;&lt;h2 id=&quot;初始化项目&quot;&gt;&lt;a href=&quot;#初始化项目&quot; class=&quot;headerlink&quot; title=&quot;初始化项目&quot;&gt;</summary>
      
    
    
    
    
    <category term="Others" scheme="http://example.com/tags/Others/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://example.com/2022/05/20/hello-world/"/>
    <id>http://example.com/2022/05/20/hello-world/</id>
    <published>2022-05-20T15:44:47.696Z</published>
    <updated>1985-10-26T08:15:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for</summary>
      
    
    
    
    
  </entry>
  
</feed>
